# 数据库pj实验报告

## 1. 需求分析

实现了一个简单的的书城数据库管理系统，其功能包括数据库的创建、删除、查询、更新、插入等。同时，在前端界面上实现了一个简单直观的数据库管理系统，用户可以通过一系列简单的操作来管理数据库。系统涵盖了用户管理、书籍管理、购买、进货、捐赠、删除、收支计算、评论点赞等多项功能。

## 2. 概要设计

***用户管理***

实现用户注册、登录、登出等基本功能，记录用户的基本信息如用户名、密码、邮箱、性别等。管理员通过后端`SQL`语句创建，而用户则可以通过前端注册功能完成注册，前端注册用户默认为非管理员用户。根据权限不同，用户可以进行不同操作，例如非管理员用户只能进行查询和购买操作。而不能进行进货、删除等操作。管理员用户可以进行所有操作。

***书籍管理***

记录书籍的基本信息，包括`ISBN`号、书名、作者、出版社、进货价、零售价格、库存等。`ISBN`号唯一标识一本书籍，可用于查询书籍信息。库存实时更新，购买减少库存，进货增加库存。进货价和零售价格不同，前者是进货价格，后者是用户购买价格。书籍信息可通过书名等信息查询。

***进货***

记录进货时间、数量、书籍`ISBN`号等信息，进货影响库存和收支。不仅可对新书进行进货，也可对已有书籍进行进货。

***购买***

用户可在商城界面购买书籍，记录购买时间、数量、书籍`ISBN`号等信息，购买影响库存和收支。确保购买的书籍存在且库存充足，结合进货和购买记录以及书籍信息计算收支。

***点赞***

用户可对书籍进行点赞，点赞数量影响书籍热度。点赞信息实时显示在书籍信息中，确保用户可随时在前端界面点赞。

***评论***

用户可对书籍进行评论，记录评论时间、内容、用户等信息，评论信息集中在一起，可通过书名等信息查询。

***删除***

管理员可删除订单，删除后从订单列表中移除。不过通常不建议删除订单，因为这会影响收支计算且操作不可逆。

***图书馆***

每个图书馆需维护库存、图书馆的名称，并记录捐赠一本书所增加的社会声望。库存需实时更新。

***捐赠***

仅管理员可进行捐赠，记录捐赠时间、数量、用户、目标图书馆等信息。每本书的右侧需有捐赠按钮，用户可点击捐赠。需检查捐赠书籍是否存在且库存充足。捐赠信息用于计算社会声望，鼓励用户积极参与。

***ER模型图***

TODO: ER模型图

***关系模型***

TODO: 关系模型

## 详细设计

***用户管理***

这里我简单扩展了一下`auth_user`的信息，具体的表结构如下：

```sql
CREATE TABLE auth_user (
    id serial PRIMARY KEY,                           -- id
    username character varying(255) NOT NULL UNIQUE, -- 用户名
    password character varying(255) NOT NULL,        -- 密码
    is_superuser boolean NOT NULL,                   -- 权限
    first_name character varying(255) NOT NULL,      -- 真实姓名（名）
    last_name character varying(255) NOT NULL,       -- 真实姓名（姓）
    email character varying(255) NOT NULL,           -- 邮箱
    staff_number character varying(255) NOT NULL,    -- 工号
    sex character varying(255) NOT NULL,             -- 性别
    age integer NOT NULL,                            -- 年龄
    is_active boolean NOT NULL DEFAULT true          -- 是否激活
);
```

同时，